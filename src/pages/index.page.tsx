import type { GetServerSideProps, NextPage } from 'next'
import Head from 'next/head'
import { Container, LayoutDefault, Pagination } from 'src/components'
import { ProductCart, ProductSearchList } from 'src/features/Product/components'
import { productSearchUseCase } from 'src/features/Product/usecases'
import { Product } from 'src/graphql'

export const getServerSideProps: GetServerSideProps = async ({ query }) => {
  const response = await productSearchUseCase({ query })

  return {
    props: response,
  }
}

export type TPageHomeProps = {
  loading?: boolean
  products: {
    total: number
    data: Array<Product>
  }
  pages: {
    total: number
    current: number
  }
}

const HomePage: NextPage<TPageHomeProps> = ({ loading, products, pages }) => {
  const renderProductList = () => {
    if (products.total === 0)
      return (
        <Container>
          <p>Ops! No results found.</p>
        </Container>
      )

    return (
      <>
        <Container>
          <ProductSearchList total={products.total} products={products.data} />
        </Container>

        <Container>
          <Pagination total={pages.total} current={pages.current} />
        </Container>
      </>
    )
  }

  if (loading)
    return (
      <Container>
        <p>Loading...</p>
      </Container>
    )

  return (
    <>
      <Head>
        <title>Store | The best of New York</title>
        <meta name="description" content="Generated by create next app" />
      </Head>

      <LayoutDefault>{renderProductList()}</LayoutDefault>

      <ProductCart />
    </>
  )
}

export default HomePage
